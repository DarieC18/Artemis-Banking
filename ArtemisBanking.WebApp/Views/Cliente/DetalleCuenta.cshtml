@using ArtemisBanking.Application.ViewModels.Cliente
@model DetalleCuentaViewModel
@{
    ViewData["Title"] = "Detalle de cuenta";
}

<div class="container mt-3">

    <h3>Detalle de cuenta @Model.NumeroCuenta</h3>
    <p class="text-muted">Balance actual: @Model.BalanceActual.ToString("C")</p>

    <hr />

    <h5>Transacciones</h5>

    @if (Model.Transacciones.Any())
    {
        <div class="table-responsive">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>Fecha de la transacción</th>
                        <th class="text-end">Monto de la transacción</th>
                        <th>Tipo de transacción</th>
                        <th>Beneficiario</th>
                        <th>Origen</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var t in Model.Transacciones)
                    {
                        string FormatearTC(string valor)
                        {
                            if (string.IsNullOrWhiteSpace(valor))
                                return valor;

                            var digits = new string(valor.Where(char.IsDigit).ToArray());

                            if (digits.Length >= 12 && digits.Length <= 19)
                                return "****" + digits[^4..];

                            return valor;
                        }

                        var beneficiarioFmt = FormatearTC(t.Beneficiario);
                        var origenFmt = FormatearTC(t.Origen);

                        <tr>
                            <td>@t.Fecha.ToString("dd/MM/yyyy hh:mm tt")</td>
                            <td class="text-end">@t.Monto.ToString("C")</td>
                            <td>@t.Tipo</td>
                            <td>@beneficiarioFmt</td>
                            <td>@origenFmt</td>
                            <td>
                                @{
                                    var estadoClass = t.Estado.Trim().ToUpper() switch
                                    {
                                        "APROBADA" => "bg-success",
                                        "RECHAZADA" => "bg-danger",
                                        _ => "bg-secondary"
                                    };
                                }

                                <span class="badge @estadoClass">
                                    @t.Estado
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <p class="text-muted">No se han registrado transacciones para esta cuenta.</p>
    }

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-secondary">Volver atrás</a>
    </div>

</div>
