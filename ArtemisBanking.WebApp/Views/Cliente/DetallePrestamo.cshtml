@model ArtemisBanking.Application.ViewModels.Cliente.DetallePrestamoViewModel

@{
    ViewData["Title"] = "Detalle de préstamo";
}

<div class="container mt-3">

    <h3>Detalle del préstamo @Model.NumeroPrestamo</h3>

    <div class="row mb-3">
        <div class="col-md-6">
            <p><strong>Monto capital:</strong> @Model.MontoCapital.ToString("C")</p>
            <p><strong>Monto pendiente:</strong> @Model.MontoPendiente.ToString("C")</p>
            <p><strong>Tasa de interés:</strong> @($"{Model.TasaInteres} %")</p>
        </div>
        <div class="col-md-6">
            <p><strong>Cuotas totales:</strong> @Model.CuotasTotales</p>
            <p><strong>Cuotas pagadas:</strong> @Model.CuotasPagadas</p>
            <p><strong>Plazo:</strong> @Model.PlazoMeses meses</p>
            <p>
                <strong>Estado:</strong>
                @{
                    var estadoClass = Model.EstadoPago?.Trim().ToLower() switch
                    {
                        "al dia" => "bg-success",
                        "en mora" => "bg-danger",
                        _ => "bg-secondary"
                    };
                }
                <span class="badge @estadoClass">
                    @Model.EstadoPago
                </span>
            </p>
        </div>
    </div>

    <hr />

    <h5>Tabla de amortización</h5>

    @if (Model.Cuotas.Any())
    {
        <div class="table-responsive">
            <table class="table table-sm table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th># Cuota</th>
                        <th>Fecha de pago</th>
                        <th class="text-end">Valor cuota</th>
                        <th class="text-end">Pendiente por pagar</th>
                        <th class="text-center">Estado de pago</th>
                        <th class="text-center">Atraso</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var c in Model.Cuotas)
                    {
                        var esParcial = !c.Pagada && c.SaldoPendiente > 0 && c.SaldoPendiente < c.ValorCuota;
                        var estadoPagoClass = c.Pagada
                        ? "bg-success"
                        : (esParcial ? "bg-info" : "bg-secondary");
                        var estadoPagoTexto = c.Pagada
                        ? "Pagada"
                        : (esParcial ? "Parcial" : "No pagada");

                        <tr>
                            <td>@c.NumeroCuota</td>
                            <td>@c.FechaPago.ToString("dd/MM/yyyy")</td>

                            <!-- Cuota fija francesa -->
                            <td class="text-end">@c.ValorCuota.ToString("C")</td>

                            <!-- Lo que falta por pagar de ESA cuota -->
                            <td class="text-end">@c.SaldoPendiente.ToString("C")</td>

                            <td class="text-center">
                                <span class="badge @estadoPagoClass">
                                    @estadoPagoTexto
                                </span>
                            </td>
                            <td class="text-center">
                                @if (c.Atrasada)
                                {
                                    <span class="badge bg-danger">Atrasada</span>
                                }
                                else
                                {
                                    <span class="badge bg-success">En tiempo</span>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <p class="text-muted">No se encontraron cuotas registradas para este préstamo.</p>
    }

    <div class="mt-3">
        <a asp-action="Index" class="btn btn-secondary">Volver atrás</a>
    </div>

</div>
